const term = new Terminal({
    cursorBlink: true,
    theme: { background: "#000", foreground: "#00ff9d" }
});
term.open(document.getElementById("terminal"));

term.writeln("Pentest Terminal â€” Mode B");
term.writeln("Commands: headers, ssl, whois, dns, scan\n");
term.prompt = () => term.write("\n$ ");
term.prompt();

let buffer = "";

term.onKey(e => {
    const char = e.key;

    if (char === "\r") {
        execute(buffer.trim());
        buffer = "";
        term.prompt();
    } else if (char === "\u007F") {
        if (buffer.length > 0) {
            buffer = buffer.slice(0, -1);
            term.write("\b \b");
        }
    } else {
        buffer += char;
        term.write(char);
    }
});

function execute(cmd) {
    const parts = cmd.split(" ");
    const command = parts[0];
    const arg = parts[1] || "";

    if (!command) return;

    const apiMap = {
        headers: "api/headers.php?url=" + arg,
        ssl: "api/ssl.php?domain=" + arg,
        whois: "api/whois.php?domain=" + arg,
        dns: "api/dns.php?domain=" + arg,
        scan: "api/scan.php?url=" + arg
    };

    if (!apiMap[command]) {
        term.writeln("Unknown command.");
        return;
    }

    term.writeln(`\nRunning: ${command} ${arg} ...`);

    fetch(apiMap[command])
        .then(r => r.text())
        .then(text => term.writeln(text))
        .catch(err => term.writeln("Error: " + err));
}
