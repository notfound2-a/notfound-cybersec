const term = new Terminal({
    cursorBlink: true,
    theme: {
        background: "#0d1117",
        foreground: "#00ffee"
    }
});

term.open(document.getElementById("terminal"));

term.write("404 NOT FOUND CYBERSECURITY TERMINAL\n");
term.write("Ketik 'help' untuk melihat perintah.\n\n");

let currentInput = "";

term.write("> ");

term.onKey(e => {
    const key = e.key;

    if (key === "\r") {
        handleCommand(currentInput.trim());
        currentInput = "";
        term.write("\n> ");
        return;
    }

    if (key === "\u007F") {
        if (currentInput.length > 0) {
            currentInput = currentInput.slice(0, -1);
            term.write("\b \b");
        }
        return;
    }

    currentInput += key;
    term.write(key);
});

function handleCommand(cmd) {
    if (!cmd) return;

    const args = cmd.split(" ");
    const command = args[0];
    const target = args[1];

    switch (command) {
        case "help":
            term.write(
                "\nPerintah Tersedia:\n" +
                "  scan <domain>     → Full scan\n" +
                "  headers <domain>  → Cek Security Headers\n" +
                "  ssl <domain>      → Info SSL Certificate\n" +
                "  whois <domain>    → WHOIS Lookup\n" +
                "  dns <domain>      → DNS Lookup\n"
            );
            break;

        case "scan": runFullScan(target); break;
        case "headers": checkHeaders(target); break;
        case "ssl": checkSSL(target); break;
        case "whois": checkWHOIS(target); break;
        case "dns": checkDNS(target); break;

        default:
            term.write(`\nPerintah tidak dikenal: ${command}`);
    }
}
