const term = new Terminal({
    theme: {
        background: "#0d0d16",
        foreground: "#00f6ff"
    }
});

term.open(document.getElementById('terminal'));
term.write("404 NOT FOUND CYBERSECURITY TERMINAL\r\n");
term.write("Ketik 'help' untuk melihat perintah.\r\n\n");

let prompt = "> ";
term.write(prompt);

let buffer = "";

function printMenu() {
    term.writeln("");
    term.writeln("=== MENU UTAMA ===");
    term.writeln("1 → WHOIS Lookup");
    term.writeln("2 → Full Scan");
    term.writeln("3 → Security Headers");
    term.writeln("4 → DNS Lookup");
    term.writeln("5 → SSL Info");
    term.writeln("");
    term.writeln("help → lihat bantuan");
    term.writeln("clear → bersihkan layar");
    term.writeln("exit → keluar");
    term.writeln("");
}

function runCommand(cmd) {
    const parts = cmd.split(" ");
    const action = parts[0];
    const target = parts[1];

    switch(action) {

        case "help":
            printMenu();
            break;

        case "clear":
            term.clear();
            break;

        case "exit":
            term.writeln("Menutup terminal...");
            setTimeout(() => window.location.href = "../../index.html", 800);
            break;

        // ======== MENU ANGKA =========
        case "1":
            if (!target) return term.writeln("Format: 1 domain.com");
            fetchApi("whois", target);
            break;

        case "2":
            if (!target) return term.writeln("Format: 2 domain.com");
            fetchApi("scan", target);
            break;

        case "3":
            if (!target) return term.writeln("Format: 3 domain.com");
            fetchApi("headers", target);
            break;

        case "4":
            if (!target) return term.writeln("Format: 4 domain.com");
            fetchApi("dns", target);
            break;

        case "5":
            if (!target) return term.writeln("Format: 5 domain.com");
            fetchApi("ssl", target);
            break;

        default:
            term.writeln("Perintah tidak dikenal. Ketik 'help'.");
    }
}

function fetchApi(type, domain) {
    term.writeln(`\r\nMenjalankan ${type.toUpperCase()} untuk ${domain}...\r\n`);

    fetch(`api/${type}.php?domain=${domain}`)
        .then(res => res.text())
        .then(txt => term.writeln(txt))
        .catch(err => term.writeln("Error: " + err.message));
}

term.onKey(e => {
    const char = e.key;

    if (e.domEvent.key === "Enter") {
        term.writeln("");
        runCommand(buffer.trim());
        buffer = "";
        term.write("\r\n" + prompt);
    } 
    else if (e.domEvent.key === "Backspace") {
        if (buffer.length > 0) {
            buffer = buffer.slice(0, -1);
            term.write("\b \b");
        }
    } 
    else {
        buffer += char;
        term.write(char);
    }
});
