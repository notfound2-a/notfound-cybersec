const term = new Terminal({
    cursorBlink: true,
    fontFamily: "monospace",
    fontSize: 15,
    theme: {
        background: "#000814",
        foreground: "#00eaff",
        cursor: "#00f6ff"
    }
});

term.open(document.getElementById("terminal"));

term.writeln("====================================");
term.writeln("   404 NOT FOUND CYBERSECURITY CLI");
term.writeln("====================================");
term.writeln("Ketik: help");
term.writeln("");
term.write("> ");

let buffer = "";

function menu() {
    term.writeln("");
    term.writeln("=== MENU SCANNER ===");
    term.writeln("1 → WHOIS Lookup");
    term.writeln("2 → Full Scan");
    term.writeln("3 → Security Headers");
    term.writeln("4 → DNS Lookup");
    term.writeln("5 → SSL Info");
    term.writeln("");
    term.writeln("help → Bantuan");
    term.writeln("clear → Bersihkan layar");
    term.writeln("exit → Keluar terminal");
    term.writeln("");
}

function handle(cmd) {
    const parts = cmd.split(" ");
    const op = parts[0];
    const target = parts[1];

    switch(op) {

        case "help":
            menu();
            return;

        case "clear":
            term.clear();
            return;

        case "exit":
            term.writeln("Menutup terminal...");
            setTimeout(() => window.location.href = "../../index.html", 500);
            return;

        case "1": return api("whois", target);
        case "2": return api("scan", target);
        case "3": return api("headers", target);
        case "4": return api("dns", target);
        case "5": return api("ssl", target);

        default:
            term.writeln("Perintah tidak dikenal. Ketik: help");
            return;
    }
}

function api(name, domain) {
    if (!domain) {
        term.writeln("Format: " + name + " domain.com");
        return;
    }

    term.writeln(`\nMenjalankan ${name.toUpperCase()} untuk ${domain}...\n`);

    fetch(`api/${name}.php?domain=${domain}`)
        .then(r => r.text())
        .then(txt => term.writeln(txt))
        .catch(err => term.writeln("Error: " + err));
}

term.onKey(e => {
    const key = e.key;

    if (e.domEvent.key === "Enter") {
        term.writeln("");
        handle(buffer.trim());
        buffer = "";
        term.write("\n> ");
        return;
    }

    if (e.domEvent.key === "Backspace") {
        if (buffer.length > 0) {
            buffer = buffer.slice(0, -1);
            term.write("\b \b");
        }
        return;
    }

    buffer += key;
    term.write(key);
});
